<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Faturas</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<div class="container">

<nav id="side-menu">
  <h2>⚡ Energia</h2>
  <ul>
    <li><a href="index.html">Dashboard</a></li>
    <li><a href="empresas.html">Empresas</a></li>
    <li><a href="lojas.html">Lojas</a></li>
    <li><a href="unidades.html">Unidades</a></li>
    <li><a href="faturas.html">Faturas</a></li>
  </ul>
</nav>

<main>
<h2>Faturas</h2>

<div class="card">
  <label>Unidade Consumidora</label>
  <select id="unidadeSelect"></select>

  <label>Importar fatura (PDF)</label>
  <input type="file" id="pdfInput" accept="application/pdf">

  <hr>

  <label>Mês/Ano</label>
  <input id="mesAno">

  <label>Vencimento</label>
  <input type="date" id="vencimento">

  <label>Energia Ativa (kWh)</label>
  <input id="consumoAtivo" type="number">

  <label>Energia Geração (kWh)</label>
  <input id="energiaGeracao" type="number">

  <label>Consumo Total (kWh)</label>
  <input id="consumoTotal" type="number" readonly>

  <label>Valor (R$)</label>
  <input id="valor" type="number" step="0.01">

  <button id="btnSalvar">Salvar fatura</button>
</div>

</main>
</div>

<script src="assets/js/supabase.js"></script>

<script src="assets/libs/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "assets/libs/pdf.worker.min.js";
</script>

<script src="assets/js/pdf-import.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  const pdfInput = document.getElementById("pdfInput");

  pdfInput.addEventListener("change", async (e) => {
    const dados = await importarFaturaEquatorial(e.target.files[0]);
    console.log("PDF importado:", dados);

    mesAno.value = dados.mes_ano;
    vencimento.value = dados.vencimento;
    consumoAtivo.value = dados.consumo_ativo_kwh;
    energiaGeracao.value = dados.energia_geracao_kwh;
    consumoTotal.value = dados.consumo_total_kwh;
    valor.value = dados.valor;
  });

});
</script>

</body>
</html>
