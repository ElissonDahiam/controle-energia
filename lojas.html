<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Lojas</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<div class="container">

  <nav id="side-menu">
    <h2>⚡ Energia</h2>
    <ul>
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="empresas.html">Empresas</a></li>
      <li><a href="lojas.html">Lojas</a></li>
      <li><a href="unidades.html">Unidades</a></li>
      <li><a href="faturas.html">Faturas</a></li>
      <li><a href="relatorios.html">Relatórios</a></li>
      <li><a href="configuracoes.html">Configurações</a></li>
    </ul>
  </nav>

  <main>
    <h2>Lojas</h2>

    <div class="card">
      <label>Empresa</label>
      <select id="empresaLoja"></select>

      <label>Nome da loja</label>
      <input id="nomeLoja" placeholder="Ex: Loja 07">

      <button onclick="cadastrarLoja()">Salvar loja</button>
    </div>

    <div class="card">
      <h3>Lojas cadastradas</h3>
      <ul id="listaLojas"></ul>
    </div>
  </main>

</div>

<!-- 1️⃣ SUPABASE -->
<script src="assets/js/supabase.js"></script>

<!-- 2️⃣ SCRIPT DA PÁGINA -->
<script>
async function carregarEmpresas() {
  const select = document.getElementById("empresaLoja");
  select.innerHTML = "";

  const empresas = await listarEmpresas();
  empresas.forEach(e => {
    const opt = document.createElement("option");
    opt.value = e.id;
    opt.textContent = e.nome;
    select.appendChild(opt);
  });

  if (empresas.length > 0) {
    carregarLojas(empresas[0].id);
  }
}

async function carregarLojas(empresa_id) {
  const lista = document.getElementById("listaLojas");
  lista.innerHTML = "";

  const lojas = await listarLojas(empresa_id);
  lojas.forEach(l => {
    const li = document.createElement("li");
    li.textContent = l.nome;
    lista.appendChild(li);
  });
}

async function cadastrarLoja() {
  const empresa_id = document.getElementById("empresaLoja").value;
  const nome = document.getElementById("nomeLoja").value.trim();

  if (!nome) {
    alert("Informe o nome da loja");
    return;
  }

  await salvarLoja(nome, empresa_id);
  document.getElementById("nomeLoja").value = "";
  carregarLojas(empresa_id);
}

document.getElementById("empresaLoja")
  .addEventListener("change", e => {
    carregarLojas(e.target.value);
  });

carregarEmpresas();
</script>

</body>
</html>
