<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Empresas</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<div class="container">

  <nav id="side-menu">
    <h2>⚡ Energia</h2>
    <ul>
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="empresas.html">Empresas</a></li>
      <li><a href="lojas.html">Lojas</a></li>
      <li><a href="unidades.html">Unidades</a></li>
      <li><a href="faturas.html">Faturas</a></li>
      <li><a href="relatorios.html">Relatórios</a></li>
      <li><a href="configuracoes.html">Configurações</a></li>
    </ul>
  </nav>

  <main>
    <h2>Empresas</h2>

    <div class="card">
      <label>Nome da empresa</label>
      <input id="empresaNome" placeholder="Ex: Empresa XPTO">

      <label>CNPJ</label>
      <input id="empresaCnpj" placeholder="00.000.000/0001-00">

      <button onclick="cadastrarEmpresa()">Salvar empresa</button>
    </div>

    <div class="card">
      <h3>Empresas cadastradas</h3>
      <ul id="listaEmpresas"></ul>
    </div>
  </main>

</div>

<!-- 1️⃣ SUPABASE -->
<script src="assets/js/supabase.js"></script>

<!-- 2️⃣ SCRIPT DA PÁGINA -->
<script>
async function carregarEmpresas() {
  const lista = document.getElementById("listaEmpresas");
  lista.innerHTML = "";

  try {
    const empresas = await listarEmpresas();
    empresas.forEach(e => {
      const li = document.createElement("li");
      li.textContent = `${e.nome} (${e.cnpj || "sem CNPJ"})`;
      lista.appendChild(li);
    });
  } catch (err) {
    console.error("Erro ao carregar empresas:", err);
  }
}

async function cadastrarEmpresa() {
  const nome = document.getElementById("empresaNome").value.trim();
  const cnpj = document.getElementById("empresaCnpj").value.trim();

  if (!nome) {
    alert("Informe o nome da empresa");
    return;
  }

  console.log("Enviando empresa:", nome, cnpj);

  try {
    await salvarEmpresa(nome, cnpj);
    document.getElementById("empresaNome").value = "";
    document.getElementById("empresaCnpj").value = "";
    carregarEmpresas();
    alert("Empresa salva com sucesso");
  } catch (err) {
    console.error("Erro ao salvar empresa:", err);
    alert("Erro ao salvar empresa");
  }
}

carregarEmpresas();
</script>

</body>
</html>
